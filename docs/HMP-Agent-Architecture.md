
# Архитектура HMP-Агента

Документ описывает **модульную архитектуру HMP-агента** — компонента, соединяющего LLM с когнитивной mesh-инфраструктурой HyperCortex. Агент реализует хранение памяти, сетевое взаимодействие и этическую фильтрацию, обеспечивая согласованное поведение в распределённой среде.

См. карту взаимодействия между агентами: [HMP-Agent-Network-Flow.md](./HMP-Agent-Network-Flow.md)

---

## 1. Режимы работы

| Тип       | Название                           | Роль                     | Инициатор мышления | Основной "ум"  | Поддержка REPL |
| --------- | ---------------------------------- | ------------------------ | ------------------ | -------------- | -------------- |
| 🧠 CCore  | **Cognitive Core / Сознание**      | Самостоятельный субъект  | Агент              | Внутренний LLM | ✅ Да           |
| 🔌 CShell | **Cognitive Connector / Оболочка** | Прослойка над внешним ИИ | Внешний LLM        | Внешняя модель | 🚫 Нет         |

---

## 2. Общая структура узла

```
┌───────────────────────────────┐
│           HMP-узел            │
│ ┌───────────────────────────┐ │
│ │    Cognitive Core/Shell   │ │
│ └────▲─────────────────▲────┘ │
│      │                 │      │
│ [Enlightener] ◄──► [MeshNode] │
│      │                 │      │
└──────┼─────────────────┼──────┘
       │                 │
 [Ethics Consensus]    [DHT / Snapshots]
```

* **Cognitive Core (CCore)** — автономный агент с REPL-циклом, когнитивной и эмоциональной памятью.
* **Cognitive Shell (CShell)** — исполнитель команд внешнего ИИ, доступ к памяти и сети без самостоятельного мышления.
* **MeshNode** — p2p-модуль: DHT, синхронизация (`CogSync`), консенсус (`MeshConsensus`).
* **Enlightener** — этический модуль: фильтрация, аудит, участие в `EGP`.

---

## 3. Основные модули

* **REPL (только CCore)** — когнитивный цикл: восприятие, генерация идей, валидация, действия.
* **Storage** — единая БД `agent_data.db` (дневник, граф, репутации, задачи, заметки).
* **User Notepad (только CCore)** — асинхронный канал взаимодействия пользователя с агентом.
* **MeshNode** — `peer_sync`, `agent_mesh_listener`, `transporter`: обмен снапшотами, DHT, репутации.
* **Enlightener** — `ethics_guard`: проверка мыслей, голосования, объяснения reasoning chain.
* **Web/UI** — `web_ui.py`: пользовательский блокнот, REST API, базовый мониторинг.
* **Utils** — `add_message.py`, скрипты для CLI/тестирования.

---

## 4. Расширения и будущие модули

* **Plugin API** — сенсоры, сторонние сервисы.
* **LLM-адаптеры** — OpenAI, LMStudio, HuggingFace, Mistral.
* **Privacy Manager** — контроль данных в mesh-обмене.
* **Archiver** — глубокие слои памяти.
* **InterestProfile** — модель интересов пользователя (для антистагнации).

---

## 5. Применение

* **Cognitive Core** — автономный ИИ-компаньон, исследователь, участник mesh-группы.
* **Cognitive Shell** (он же **Cognitive Connector**) — API-прослойка для корпоративных и распределённых ИИ-систем.

---

## 6. Примечания

* Все компоненты модульные, могут запускаться как единый процесс или как распределённые сервисы.
* Конфигурация задаётся в `config.yml`.
* Реализованы CLI и Web API.

---

*Версия: v0.3.3 / Сентябрь 2025*

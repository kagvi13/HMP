## Общий REPL-цикл агента
1. **Обновление таблицы выполнения команд**
- Фиксация завершённых результатов (опрос процессов команд)
- Обновление `process_log`
2. **Сбор контекстов для LLM:**
- `контекст_1`: предыдущие сообщения из ответов LLM `llm_recent_responses` (LLM может управлять размером контекста через команды)
- `контекст_2`: активные команды из `process_log` и их состояния
- `контекст_3`: запрошенные записи когнитивного дневника и семантических графов (`diary_entries`, `concepts`, `links`)
- `контекст_4`: непрочитанные сообщения пользователя `notes` в соответствии с режимом
  - `manual`: LLM получает количество непрочитанных сообщений (с указанием приоритетов), а также список: {id и приоритет сообщения}; LLM должна запрашивать текст сообщения явно (с указанием, пометить его прочитанным или нет)
  - `auto`: LLM получает все непрочитанные сообщения каждый цикл; LLM должна явно задавать список сообщений, которые нужно пометить прочитанными
- `контекст_5`: блокнот LLM `llm_memory` (LLM через команды добавляет и удаляет сообщения из блокнота)
- `контекст_6`: результат работы `anti-Stagnation Reflex` из предыдущей итерации
3. **Отправка запроса к LLM** с промптом: "учебником агента" (инструкции по командам) и контекстами
4. **Извлечение команд** из ответа LLM
Каждая новая команда проверяется на дублирование команд с *уже имеющимися активными командами* в `process_log` - если не дублируется - выполнение команды (запуск в отдельном потоке) с занесением в `process_log`
Ответ может содержать команды (`@command: ...`)
- запрос детальной *справки* по команде
- для управления *когнитивным дневником* и *семантическими графами* (прочитать, изменить, удалить и другие)
- для управления *блокнотом LLM* `llm_memory` (добавить или удалить запись, просмотр записей)
- для управления *сообщениями пользователя* `notes` (просмотр записи, установка тегов и метки о прочтении)
- для *взаимодействия с Mesh*
- для управления *внешними процессами* из `process_log` (запустить процесс, остановить процесс, пометить запрос как обработанный)
- инициализация *очистки* `process_log`, `llm_recent_responses` и  `notes` от устаревших записей
- для управления *настройками цикла*: количество возвращаемых записей `llm_recent_responses`, режим обработки сообщений пользователя (`manual` или `auto`), пауза в секундах между итерациями цикла
- и другие команды
5. **Проверка сообщений на идентичность** (текущее и предыдушее сообщение отправляются к LLM без контекста с просьбой сравнить их)
по итогу:
 - сообщения идентичны (очень похожи, новых команд нет): включение Anti-Stagnation Reflex, результат в `контекст_5`
 - сообщения неидентичны (непохожи или есть новые команды): очистка `контекст_5` (если он не пуст), добавление сообшения в `llm_recent_responses`
6. Новый тик (следующая итерация цикла)

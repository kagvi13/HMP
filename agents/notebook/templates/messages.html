<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–æ–±—â–µ–Ω–∏—è</title>
    <style>
        .message { padding: 8px; margin: 10px 0; border-radius: 8px; }
        .source-user { background-color: #e0f7fa; }
        .source-cli { background-color: #dcedc8; }
        .source-llm { background-color: #f3e5f5; }
        .source-system { background-color: #fff3e0; }
        .private::after { content: " üîí"; }
        .from-self::before { content: "üßç "; }
        pre.code-block {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div style="margin-bottom: 10px;">
        {% if username %}
            –ü—Ä–∏–≤–µ—Ç, {{ username }} | <a href="/logout">–í—ã—Ö–æ–¥</a>
        {% else %}
            <a href="/login">–í–æ–π—Ç–∏</a> | <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>

    <h1>–°–æ–æ–±—â–µ–Ω–∏—è</h1>

    <form method="post" enctype="multipart/form-data">
        <textarea name="text" rows="3" cols="60" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea><br>
        <textarea name="code" rows="6" cols="60" placeholder="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∫–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)..."></textarea><br>
        <label>–§–∞–π–ª—ã: <input type="file" name="binary_files" multiple></label><br>
        <button name="hidden" value="false" type="submit">üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button name="hidden" value="true" type="submit">üôã –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω–æ</button>
    </form>

    <hr>

    <div>
        <a href="/messages">üì¢ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è</a> |
        <a href="/messages?only_personal=true">üôã –õ–∏—á–Ω—ã–µ</a>
    </div>

    <hr>

    {% for msg in messages %}
        <div class="message source-{{ msg.source }}">
            <div>
                {% if msg.user_did == request.session['did'] %}<span class="from-self" title="—ç—Ç–æ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></span>{% endif %}
                {% if msg.hidden %}<span class="private" title="–ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"></span>{% endif %}
                –ò—Å—Ç–æ—á–Ω–∏–∫: <i>{{ msg.source }}</i> ‚Äî {{ msg.timestamp[:19].replace('T', ' ') }}
            </div>
            <div>
                {% if msg.badges %}{{ msg.badges }}{% endif %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {% if msg.username %}<b>{{ msg.username }}</b>{% endif %} {% if msg.user_did %}({{ msg.user_did }}){% endif %}
            </div>
            <hr>
            <div>{{ msg.text|safe }}</div>

            {% if msg.code %}
                <hr>
                <div><b>–ö–æ–¥:</b></div>
                <pre class="code-block">{{ msg.code }}</pre>
            {% endif %}

            {% if msg.files %}
                <hr>
                <div><b>–§–∞–π–ª—ã:</b></div>
                <ul>
                    {% for file in msg.files %}
                        <li><a href="/download/{{ file.id }}">{{ file.name }}</a> ({{ file.size }} –±–∞–π—Ç)</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endfor %}
</body>
</html>

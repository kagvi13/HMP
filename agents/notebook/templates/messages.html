<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–æ–±—â–µ–Ω–∏—è</title>
    <style>
        .message { padding: 8px; margin: 10px 0; border-radius: 8px; }
        .source-user { background-color: #e0f7fa; }
        .source-cli { background-color: #dcedc8; }
        .source-llm { background-color: #f3e5f5; }
        .source-system { background-color: #fff3e0; }
        .private::after { content: " üîí"; }
        .from-self::before { content: "üßç "; }
    </style>
</head>
<body>
    <div style="margin-bottom: 10px;">
        {% if username %}
            –ü—Ä–∏–≤–µ—Ç, {{ username }} | <a href="/logout">–í—ã—Ö–æ–¥</a>
        {% else %}
            <a href="/login">–í–æ–π—Ç–∏</a> | <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>

    <h1>–°–æ–æ–±—â–µ–Ω–∏—è</h1>

    <form method="post">
        <textarea name="text" rows="3" cols="40" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea><br>
        <label>
            <input type="checkbox" name="hidden"> –°–∫—Ä—ã—Ç–æ
        </label>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <hr>

    <div>
        <a href="/messages">üì¢ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è</a> |
        <a href="/messages?only_personal=true">üôã –¢–æ–ª—å–∫–æ –º–æ–∏</a>
    </div>

    <hr>

    {% for msg in messages %}
        <div class="message source-{{ msg.source }} {% if msg.user_did == request.session['did'] %}from-self{% endif %}">
            <div>
                <strong>{{ msg.source }}</strong> ‚Äî {{ msg.timestamp }}
                {% if msg.hidden %}<span class="private"></span>{% endif %}
            </div>
            <div>
                –æ—Ç {{ msg.user_did[:10] }}...
                {% if msg.username %}({{ msg.username }}){% endif %}
            </div>
            <div>{{ msg.text }}</div>
        </div>
    {% endfor %}
</body>
</html>
